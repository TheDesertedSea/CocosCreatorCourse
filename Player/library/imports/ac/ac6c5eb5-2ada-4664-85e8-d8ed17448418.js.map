{"version":3,"sources":["assets\\scripts\\Weapon.js"],"names":["cc","Class","Component","properties","bullet","type","Prefab","Rocker","node","onLoad","name","parent","getChildByName","RockerScript","getComponent","fire","scene","director","getScene","instantiate","position","convertToWorldSpaceAR","v2","setPosition","x","y","angle","setDir","dirX","dirY","start","update","dt","dir","mag","r","Math","atan2","degree","PI"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AACRC,IAAAA,MAAM,EACN;AACI,iBAAQ,IADZ;AACmB;AACfC,MAAAA,IAAI,EAAEL,EAAE,CAACM;AAFb,KAFQ;AAMRC,IAAAA,MAAM,EAAC;AACHF,MAAAA,IAAI,EAACL,EAAE,CAACQ,IADL;AACa;AAChB,iBAAQ;AAFL,KANC;AAURH,IAAAA,IAAI,EAAC;AAVG,GAHP;AAgBL;AAEAI,EAAAA,MAlBK,oBAkBK;AACN,SAAKD,IAAL,CAAUE,IAAV,GAAe,QAAf,CADM,CACqB;;AAC3B,SAAKH,MAAL,GAAY,KAAKC,IAAL,CAAUG,MAAV,CAAiBC,cAAjB,CAAgC,UAAhC,CAAZ;AACA,SAAKC,YAAL,GAAkB,KAAKN,MAAL,CAAYO,YAAZ,CAAyB,UAAzB,CAAlB,CAHM,CAGmD;AAC5D,GAtBI;AAuBLC,EAAAA,IAAI,EAAC,gBAAU;AAAG;AACd,QAAG,KAAKV,IAAL,IAAW,CAAd,EAAkB;AAClB;AAAC;AACD,YAAIW,KAAK,GAAGhB,EAAE,CAACiB,QAAH,CAAYC,QAAZ,EAAZ;AACA,YAAId,MAAM,GAACJ,EAAE,CAACmB,WAAH,CAAe,KAAKf,MAApB,CAAX,CAFA,CAEyC;;AACzCA,QAAAA,MAAM,CAACO,MAAP,GAAc,KAAKH,IAAnB;AACA,YAAIY,QAAQ,GAAC,KAAKZ,IAAL,CAAUa,qBAAV,CAAgCrB,EAAE,CAACsB,EAAH,CAAM,CAAN,EAAQ,EAAR,CAAhC,CAAb,CAJA,CAKA;;AACAlB,QAAAA,MAAM,CAACO,MAAP,GAAcK,KAAd;AACAZ,QAAAA,MAAM,CAACmB,WAAP,CAAmBH,QAAQ,CAACI,CAA5B,EAA8BJ,QAAQ,CAACK,CAAvC,EAPA,CAO4C;;AAC5CrB,QAAAA,MAAM,CAACsB,KAAP,GAAa,KAAKlB,IAAL,CAAUkB,KAAvB,CARA,CAQ+B;;AAC/BtB,QAAAA,MAAM,CAACU,YAAP,CAAoB,QAApB,EAA8Ba,MAA9B,CAAqC,KAAKC,IAA1C,EAA+C,KAAKC,IAApD;AACH,OAXG,MAYA,CAAC;AAEJ;AAEA,GAxCI;AA0CLC,EAAAA,KA1CK,mBA0CI,CAER,CA5CI;AA8CLC,EAAAA,MA9CK,kBA8CGC,EA9CH,EA8CO;AAER,QAAG,KAAKnB,YAAL,CAAkBoB,GAAlB,CAAsBC,GAAtB,KAA4B,GAA/B,EAAmC;AAC/B;AACH;;AACD,QAAIC,CAAC,GAAGC,IAAI,CAACC,KAAL,CAAW,KAAKxB,YAAL,CAAkBoB,GAAlB,CAAsBR,CAAjC,EAAmC,KAAKZ,YAAL,CAAkBoB,GAAlB,CAAsBT,CAAzD,CAAR,CALQ,CAK4D;;AACpE,QAAIc,MAAM,GAAGH,CAAC,GAAG,GAAJ,GAASC,IAAI,CAACG,EAA3B,CANQ,CAMyB;;AACjCD,IAAAA,MAAM,GAAGA,MAAM,GAAC,EAAhB,CAPQ,CAOa;;AAErB,SAAK9B,IAAL,CAAUkB,KAAV,GAAkBY,MAAlB;AACA,SAAKV,IAAL,GAAU,KAAKf,YAAL,CAAkBoB,GAAlB,CAAsBT,CAAhC,CAVQ,CAU6B;;AACrC,SAAKK,IAAL,GAAU,KAAKhB,YAAL,CAAkBoB,GAAlB,CAAsBR,CAAhC;AACH;AA1DI,CAAT","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bullet:\r\n        {\r\n            default:null,  //发射的子弹预制体\r\n            type: cc.Prefab,\r\n        },\r\n        Rocker:{\r\n            type:cc.node,   //绑定虚拟摇杆结点以获取摇杆信息\r\n            default:null,\r\n        },\r\n        type:0,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.node.name=\"weapon\";   //将结点名称设置为“weapon”(Player脚本需要)\r\n        this.Rocker=this.node.parent.getChildByName(\"Joystick\");\r\n        this.RockerScript=this.Rocker.getComponent(\"Joystick\");  //获取“Joystick”脚本为RockerScript\r\n    },\r\n    fire:function(){  //开火\r\n        if(this.type==0)  //type==0为远程武器。发射子弹\r\n        {//cc.log(\"fire!\");\r\n        var scene = cc.director.getScene();\r\n        var bullet=cc.instantiate(this.bullet);  //实例化预制体\r\n        bullet.parent=this.node;\r\n        var position=this.node.convertToWorldSpaceAR(cc.v2(0,50));\r\n        //cc.log(position.x,position.y);\r\n        bullet.parent=scene;\r\n        bullet.setPosition(position.x,position.y);  //设置子弹的生成位置\r\n        bullet.angle=this.node.angle;  //设置子弹的角度\r\n        bullet.getComponent(\"Bullet\").setDir(this.dirX,this.dirY);\r\n    }\r\n    else{//近战攻击待实现\r\n        \r\n    }\r\n        \r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n\r\n        if(this.RockerScript.dir.mag()<0.5){\r\n            return;\r\n        }\r\n        var r = Math.atan2(this.RockerScript.dir.y,this.RockerScript.dir.x);//从RockerScript中获取摇杆角度信息\r\n        var degree = r * 180/(Math.PI);  //计算角度\r\n        degree = degree-90;  //设置角度\r\n\r\n        this.node.angle = degree;\r\n        this.dirX=this.RockerScript.dir.x;   //存储获得到的摇杆角度信息\r\n        this.dirY=this.RockerScript.dir.y;\r\n    },\r\n});\r\n\r\n"]}