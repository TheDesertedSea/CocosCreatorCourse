{"version":3,"sources":["assets\\scripts\\Joystick.js"],"names":["cc","Class","Component","properties","Rocker","type","Node","Origin","Max_r","start","x","y","dir","v2","on","EventType","TOUCH_START","e","w_pos","getLocation","pos","convertToNodeSpaceAR","len","mag","setPosition","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n   \r\n        Rocker:{  //摇杆体\r\n            type:cc.Node,\r\n            default:null,\r\n        },\r\n        Origin:cc.Node,  //该结点不可见，保存了摇杆初始位置，由于虚拟摇杆需和玩家一起动（相机跟随了）\r\n        //，而TOUCH_START事件返回的坐标又是屏幕的坐标（左下角为（0，0）），所以需保存一个初始坐标（一开始左下角为（0，0））\r\n        Max_r:120,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    start () {\r\n        this.Rocker.x = 0;\r\n        this.Rocker.y = 0;\r\n        this.dir = cc.v2(0,0);\r\n\r\n        this.Rocker.on(cc.Node.EventType.TOUCH_START,function(e){  //绑定摇杆触摸开始事件调用的函数\r\n            var w_pos = e.getLocation();  //获取触摸点屏幕点坐标\r\n           var pos = this.Origin.convertToNodeSpaceAR(w_pos);//将触摸点坐标转换为摇杆中心为原点的坐标系的坐标\r\n\r\n            var len = pos.mag();  //计算向量长度\r\n            //计算触摸点与（0，0）连线与（0，0）为原点单位圆的交点dir，该点坐标表示了摇杆方向\r\n            this.dir.x = pos.x / len;  \r\n            this.dir.y = pos.y / len;\r\n\r\n            //设置摇杆体位置\r\n            if(len > this.Max_r){  //防止摇杆体超出边界\r\n                pos.x = this.Max_r * pos.x / len;  \r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Rocker.setPosition(pos);  \r\n        },this);\r\n\r\n        this.Rocker.on(cc.Node.EventType.TOUCH_MOVE,function(e){  //绑定摇杆触摸移动事件调用的函数\r\n           var w_pos = e.getLocation();\r\n           var pos = this.Origin.convertToNodeSpaceAR(w_pos);\r\n\r\n           \r\n            var len = pos.mag();\r\n            this.dir.x = pos.x / len;\r\n            this.dir.y = pos.y / len;\r\n            if(len > this.Max_r){\r\n                pos.x = this.Max_r * pos.x / len;\r\n                pos.y = this.Max_r * pos.y / len;\r\n            }\r\n            this.Rocker.setPosition(pos);  \r\n        },this);\r\n\r\n        this.Rocker.on(cc.Node.EventType.TOUCH_END,function(e){  //摇杆体触摸结束\r\n           this.Rocker.setPosition(cc.v2(0,0));  //摇杆体归位\r\n \t\t   this.dir = cc.v2(0, 0);  //摇杆方向归位\r\n        },this);\r\n\r\n        this.Rocker.on(cc.Node.EventType.TOUCH_CANCEL,function(e){ //摇杆体触摸取消\r\n            this.Rocker.setPosition(cc.v2(0,0));\r\n \t\t\tthis.dir = cc.v2(0, 0);\r\n        },this);\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}